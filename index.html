<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>High-Precision 3D Earth Model</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            overflow: hidden;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #000;
        }
        #canvas-container {
            width: 100vw;
            height: 100vh;
        }
        #info {
            position: absolute;
            top: 20px;
            left: 20px;
            color: #fff;
            background: rgba(0, 0, 0, 0.6);
            padding: 15px;
            border-radius: 8px;
            font-size: 14px;
            line-height: 1.6;
            backdrop-filter: blur(10px);
        }
        #info h1 {
            font-size: 18px;
            margin-bottom: 10px;
        }
        #loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #fff;
            font-size: 24px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div id="canvas-container"></div>
    <div id="info">
        <h1>ğŸŒ High-Precision 3D Earth Model</h1>
        <p>Left Drag: Rotate Camera</p>
        <p>Scroll: Zoom In/Out</p>
        <p>Right Drag: Pan</p>
    </div>
    <div id="loading">Loading Earth...</div>

    <!-- Three.js CDN -->
    <script type="importmap">
    {
        "imports": {
            "three": "https://cdn.jsdelivr.net/npm/three@0.170.0/build/three.module.js",
            "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.170.0/examples/jsm/"
        }
    }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

        // ==================== Scene Setup ====================
        const scene = new THREE.Scene();
        
        // ã‚«ãƒ¡ãƒ©è¨­å®šï¼ˆPerspectiveCameraï¼‰
        const camera = new THREE.PerspectiveCamera(
            45, // FOV
            window.innerWidth / window.innerHeight, // ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”
            0.1, // Near clip
            1000 // Far clip
        );
        camera.position.set(0, 0, 4); // åœ°çƒã‹ã‚‰å°‘ã—é›¢ã‚ŒãŸä½ç½®

        // ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼è¨­å®š
        const renderer = new THREE.WebGLRenderer({ 
            antialias: true, // ã‚¢ãƒ³ãƒã‚¨ã‚¤ãƒªã‚¢ã‚¹æœ‰åŠ¹
            alpha: true 
        });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(window.devicePixelRatio);
        
        // è‰²ç©ºé–“ã¨ãƒˆãƒ¼ãƒ³ãƒãƒƒãƒ”ãƒ³ã‚°è¨­å®šï¼ˆThree.jsæ¨å¥¨è¨­å®šï¼‰
        renderer.outputColorSpace = THREE.SRGBColorSpace;
        renderer.toneMapping = THREE.ACESFilmicToneMapping;
        renderer.toneMappingExposure = 1.0;
        
        document.getElementById('canvas-container').appendChild(renderer.domElement);

        // OrbitControlsè¨­å®š
        const controls = new OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true; // ã‚¹ãƒ ãƒ¼ã‚ºãªå‹•ã
        controls.dampingFactor = 0.05;
        controls.minDistance = 1.5; // æœ€å°ã‚ºãƒ¼ãƒ è·é›¢
        controls.maxDistance = 10; // æœ€å¤§ã‚ºãƒ¼ãƒ è·é›¢
        controls.enablePan = true; // ãƒ‘ãƒ³æ“ä½œã‚’æœ‰åŠ¹åŒ–

        // å®‡å®™èƒŒæ™¯ï¼ˆæ·±ã„å®‡å®™ç©ºé–“ã®è¡¨ç¾ï¼‰
        scene.background = new THREE.Color(0x000000);

        // ==================== Lighting ====================
        // å¤ªé™½å…‰ï¼ˆDirectionalLightï¼‰- åœ°çƒã®ç‰‡å´ã‚’ç…§ã‚‰ã™
        const sunLight = new THREE.DirectionalLight(0xffffff, 2.5);
        sunLight.position.set(5, 0, 5);
        scene.add(sunLight);

        // å¼±ã„ç’°å¢ƒå…‰ï¼ˆå¤œå´ãŒçœŸã£æš—ã«ãªã‚‰ãªã„ã‚ˆã†ã«ï¼‰
        const ambientLight = new THREE.AmbientLight(0x333333, 0.3);
        scene.add(ambientLight);

        // ==================== Texture Loader ====================
        const textureLoader = new THREE.TextureLoader();

        // ãƒ†ã‚¯ã‚¹ãƒãƒ£URLï¼ˆå®Ÿéš›ã®ä½¿ç”¨æ™‚ã¯NASA Blue Marbleãªã©ã®é«˜è§£åƒåº¦ç”»åƒã‚’ä½¿ç”¨ï¼‰
        // ä¾‹: https://eoimages.gsfc.nasa.gov/images/imagerecords/
        const earthTextures = {
            // ã‚¢ãƒ«ãƒ™ãƒ‰ãƒãƒƒãƒ—ï¼ˆåœ°å½¢ãƒ»æµ·ï¼‰
            map: 'https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/textures/planets/earth_atmos_2048.jpg',
            // æ³•ç·šãƒãƒƒãƒ—ï¼ˆåœ°å½¢ã®å‡¹å‡¸ï¼‰
            normalMap: 'https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/textures/planets/earth_normal_2048.jpg',
            // ã‚¹ãƒšã‚­ãƒ¥ãƒ©ãƒãƒƒãƒ—ï¼ˆæµ·é¢åå°„ç”¨ï¼‰
            specularMap: 'https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/textures/planets/earth_specular_2048.jpg',
            // é›²ãƒãƒƒãƒ—ï¼ˆé€æ˜åº¦ä»˜ãï¼‰
            clouds: 'https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/textures/planets/earth_clouds_1024.png'
        };

        // ãƒ†ã‚¯ã‚¹ãƒãƒ£èª­ã¿è¾¼ã¿ã¨sRGBè‰²ç©ºé–“è¨­å®š
        const earthMap = textureLoader.load(earthTextures.map);
        earthMap.colorSpace = THREE.SRGBColorSpace;
        
        const normalMap = textureLoader.load(earthTextures.normalMap);
        const specularMap = textureLoader.load(earthTextures.specularMap);
        const cloudsMap = textureLoader.load(earthTextures.clouds);

        // ==================== Earth Surface Layer ====================
        // å˜ä½çƒï¼ˆåŠå¾„1.0ï¼‰ã§åœ°è¡¨ã‚’ä½œæˆ
        const earthGeometry = new THREE.SphereGeometry(
            1.0, // åŠå¾„
            128, // æ°´å¹³ã‚»ã‚°ãƒ¡ãƒ³ãƒˆæ•°ï¼ˆæ¥µåœ°ã®æ­ªã¿é˜²æ­¢ï¼‰
            128  // å‚ç›´ã‚»ã‚°ãƒ¡ãƒ³ãƒˆæ•°
        );

        // PBR Materialï¼ˆPhysically Based Renderingï¼‰
        const earthMaterial = new THREE.MeshStandardMaterial({
            map: earthMap, // ã‚¢ãƒ«ãƒ™ãƒ‰ãƒãƒƒãƒ—
            normalMap: normalMap, // æ³•ç·šãƒãƒƒãƒ—
            normalScale: new THREE.Vector2(0.85, 0.85), // æ³•ç·šã®å¼·ã•
            roughnessMap: specularMap, // ãƒ©ãƒ•ãƒã‚¹ãƒãƒƒãƒ—ï¼ˆåè»¢ä½¿ç”¨ï¼‰
            roughness: 0.9, // é™¸åœ°ã®ãƒ©ãƒ•ãƒã‚¹
            metalnessMap: specularMap, // ãƒ¡ã‚¿ãƒªãƒƒã‚¯ãƒãƒƒãƒ—ï¼ˆæµ·é¢ç”¨ï¼‰
            metalness: 0.1, // æµ·é¢ã®ãƒ¡ã‚¿ãƒªãƒƒã‚¯å€¤ï¼ˆã‚¹ãƒšã‚­ãƒ¥ãƒ©åå°„ï¼‰
            // ç’°å¢ƒå…‰é®è”½ï¼ˆå®Ÿéš›ã®ä½¿ç”¨æ™‚ã¯AOãƒãƒƒãƒ—ã‚’è¿½åŠ å¯èƒ½ï¼‰
            // aoMap: aoMap,
            // aoMapIntensity: 1.0
        });

        const earthMesh = new THREE.Mesh(earthGeometry, earthMaterial);
        scene.add(earthMesh);

        // ==================== Cloud Layer ====================
        // é›²ãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼ˆåœ°è¡¨ã‚ˆã‚Šå°‘ã—å¤§ãã„åŠå¾„ï¼‰
        const cloudsGeometry = new THREE.SphereGeometry(
            1.01, // åœ°è¡¨ã‚ˆã‚Šå°‘ã—å¤§ãã„
            64,
            64
        );

        const cloudsMaterial = new THREE.MeshStandardMaterial({
            map: cloudsMap,
            transparent: true,
            opacity: 0.8,
            depthWrite: false, // é€æ˜åº¦ã®å•é¡Œã‚’é˜²ã
            blending: THREE.NormalBlending
        });

        const cloudsMesh = new THREE.Mesh(cloudsGeometry, cloudsMaterial);
        scene.add(cloudsMesh);

        // ==================== Atmosphere Layer ====================
        // å¤§æ°—ãƒ¬ã‚¤ãƒ¤ãƒ¼ç”¨ã®ã‚«ã‚¹ã‚¿ãƒ ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ï¼ˆFresnelé¢¨ã®å¤§æ°—æ•£ä¹±ï¼‰
        const atmosphereVertexShader = `
            varying vec3 vNormal;
            varying vec3 vPosition;
            
            void main() {
                vNormal = normalize(normalMatrix * normal);
                vPosition = position;
                gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
            }
        `;

        const atmosphereFragmentShader = `
            varying vec3 vNormal;
            varying vec3 vPosition;
            
            void main() {
                // FresnelåŠ¹æœï¼ˆç¸ãŒå…‰ã‚‹ï¼‰
                vec3 viewDirection = normalize(cameraPosition - vPosition);
                float intensity = pow(1.0 - abs(dot(vNormal, viewDirection)), 2.5);
                
                // é’ã„å¤§æ°—è‰²
                vec3 atmosphereColor = vec3(0.3, 0.6, 1.0);
                
                gl_FragColor = vec4(atmosphereColor, 1.0) * intensity;
            }
        `;

        const atmosphereGeometry = new THREE.SphereGeometry(
            1.05, // ã•ã‚‰ã«å¤§ãã„åŠå¾„
            64,
            64
        );

        const atmosphereMaterial = new THREE.ShaderMaterial({
            vertexShader: atmosphereVertexShader,
            fragmentShader: atmosphereFragmentShader,
            blending: THREE.AdditiveBlending,
            side: THREE.BackSide, // è£å´ã‹ã‚‰è¦‹ãˆã‚‹ã‚ˆã†ã«
            transparent: true
        });

        const atmosphereMesh = new THREE.Mesh(atmosphereGeometry, atmosphereMaterial);
        scene.add(atmosphereMesh);

        // ==================== Stars Background ====================
        // æ˜Ÿç©ºèƒŒæ™¯ã®è¿½åŠ ï¼ˆå®‡å®™ç©ºé–“ã®è¡¨ç¾ï¼‰
        const starsGeometry = new THREE.BufferGeometry();
        const starPositions = [];
        
        for (let i = 0; i < 10000; i++) {
            const x = (Math.random() - 0.5) * 2000;
            const y = (Math.random() - 0.5) * 2000;
            const z = (Math.random() - 0.5) * 2000;
            starPositions.push(x, y, z);
        }
        
        starsGeometry.setAttribute('position', new THREE.Float32BufferAttribute(starPositions, 3));
        
        const starsMaterial = new THREE.PointsMaterial({
            color: 0xffffff,
            size: 1.5,
            sizeAttenuation: true
        });
        
        const stars = new THREE.Points(starsGeometry, starsMaterial);
        scene.add(stars);

        // ==================== Animation Loop ====================
        let earthRotationSpeed = 0.0005; // åœ°çƒã®è‡ªè»¢é€Ÿåº¦ï¼ˆ1ç§’ã‚ãŸã‚Šç´„0.03åº¦ï¼‰
        let cloudRotationSpeed = 0.0003; // é›²ã®å›è»¢é€Ÿåº¦ï¼ˆåœ°çƒã‚ˆã‚Šé…ã„ï¼‰

        function animate() {
            requestAnimationFrame(animate);

            // åœ°çƒã®è‡ªè»¢ï¼ˆYè»¸å‘¨ã‚Šï¼‰
            earthMesh.rotation.y += earthRotationSpeed;
            
            // é›²ã®ã‚†ã£ãã‚Šã—ãŸå›è»¢
            cloudsMesh.rotation.y += cloudRotationSpeed;
            
            // å¤§æ°—ã‚‚åœ°çƒã¨åŒæœŸ
            atmosphereMesh.rotation.y += earthRotationSpeed;

            // OrbitControlsã®æ›´æ–°
            controls.update();

            // ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
            renderer.render(scene, camera);
        }

        // ==================== Window Resize Handler ====================
        window.addEventListener('resize', () => {
            // ã‚«ãƒ¡ãƒ©ã®ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”æ›´æ–°
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            
            // ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ã®ã‚µã‚¤ã‚ºæ›´æ–°
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        // ==================== Loading Complete ====================
        // ãƒ†ã‚¯ã‚¹ãƒãƒ£èª­ã¿è¾¼ã¿å®Œäº†å¾Œã«ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤ºã‚’æ¶ˆã™
        const loadingElement = document.getElementById('loading');
        let texturesLoaded = 0;
        const totalTextures = 4;

        function onTextureLoad() {
            texturesLoaded++;
            if (texturesLoaded === totalTextures) {
                loadingElement.style.display = 'none';
            }
        }

        earthMap.image.addEventListener('load', onTextureLoad);
        normalMap.image.addEventListener('load', onTextureLoad);
        specularMap.image.addEventListener('load', onTextureLoad);
        cloudsMap.image.addEventListener('load', onTextureLoad);

        // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³é–‹å§‹
        animate();
    </script>
</body>
</html>
